{% extends "base.html" %}

{% block title %}My Profile - WNS Transport{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto py-10">
    <h1 class="text-3xl font-bold text-wns-blue mb-8 flex items-center">
        <i class="fas fa-user-circle mr-3"></i> My Profile
    </h1>
    <div class="bg-white rounded-lg shadow p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <div class="mb-4"><span class="font-medium text-gray-700">User ID:</span> <span id="profile-user-id" class="text-gray-900">Loading...</span></div>
                <div class="mb-4"><span class="font-medium text-gray-700">Role:</span> <span id="profile-role" class="text-gray-900">-</span></div>
                <div class="mb-4"><span class="font-medium text-gray-700">Name:</span> <span id="profile-name" class="text-gray-900">-</span></div>
                <div class="mb-4"><span class="font-medium text-gray-700">Email:</span> <span id="profile-email" class="text-gray-900">-</span></div>
                <div class="mb-4"><span class="font-medium text-gray-700">Access Level:</span> <span id="profile-access-level" class="text-gray-900">-</span></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Fetch and display full user profile details
async function loadUserProfile() {
    const user = JSON.parse(localStorage.getItem('user_info') || '{}');
    if (!user || !user.email) return;
    document.getElementById('profile-email').textContent = user.email;
    document.getElementById('profile-user-id').textContent = user.id || '-';
    document.getElementById('profile-role').textContent = user.role || '-';
    let profileData = {};
    let accessLevel = user.role || '-';
    try {
        if (user.role === 'employee') {
            const res = await fetch('/api/employees/' + encodeURIComponent(user.employee_id || user.id));
            if (res.ok) {
                const data = await res.json();
                if (data.employee) profileData = data.employee;
            }
        } else if (user.role === 'driver') {
            const res = await fetch('/api/drivers/' + encodeURIComponent(user.driver_id || user.id));
            if (res.ok) {
                const data = await res.json();
                if (data.driver) profileData = data.driver;
            }
        } else if (user.role === 'admin') {
            const res = await fetch('/api/admins/' + encodeURIComponent(user.admin_id || user.id));
            if (res.ok) {
                const data = await res.json();
                if (data.admin) profileData = data.admin;
                if (profileData.access_level) accessLevel = profileData.access_level;
            }
        }
    } catch (e) { /* ignore */ }
    document.getElementById('profile-name').textContent = profileData.name || user.name || '-';
    document.getElementById('profile-access-level').textContent = accessLevel;
}
document.addEventListener('DOMContentLoaded', loadUserProfile);
</script>
{% endblock %} 